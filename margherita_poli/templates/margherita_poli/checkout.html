{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="{% static 'css/checkout.css' %}" rel="stylesheet" />
    <title>Margherita Poli | {% trans "Checkout" %}</title>
</head>
<body>

  <!-- =========== barra superiore =========== -->
  <div class="c-brand">
    <h1 class="c-brand__title">Margherita Poli</h1>
  </div>

  <main class="c-main">
    <div class="c-main-content">
      <p class="c-main__back">
        <a href="{% url 'margherita_poli:paintings_all' %}">{% trans "Ritorna ai dipinti" %}</a>
      </p>
      <h1 class="c-main__title">{% trans "Checkout" %}</h1>
    </div>

  <!-- =========== sezione checkout ========== -->
   <div class="c-chekout">
    <div class="c-checkout__content">

        <h2 class="c-checkout__content-title">{% trans "Dettagli cliente" %}</h2>

        <form id="c-checkout__form-details" method="POST" action="{% url 'margherita_poli:process_checkout' %}">
            {% csrf_token %}

          <!-- STEP 1 -->
          <div class="c-checkout__details step-section active">
            <div class="section-content">

              <h2 class="c-checkout__details-title">{% trans "Informazioni personali" %}</h2>

              <div class="campo campo-email">
                <label for="email">{% trans "Email *" %}</label>
                <input type="email" id="email" name="email" class="checkout-field" required>
              </div>

              <div class="campo campo-fullname">

                <div class="campo campo-name">
                  <label for="nome">{% trans "Nome *" %}</label>
                  <input type="text" id="nome" name="nome" class="checkout-field" required>
                </div>

                <div class="campo campo-surname">
                  <label for="cognome">{% trans "Cognome *" %}</label>
                  <input type="text" id="cognome" name="cognome" class="checkout-field" required>
                </div>

              </div>

              <h2 class="c-checkout__details-title">{% trans "Informazioni di consegna" %}</h2>

              <div class="campo campo-state">
                <label for="stato">{% trans "Paese/Regione *" %}</label>
                <input type="text" id="stato" name="stato" class="checkout-field" required>
              </div>

              <div class="campo campo-address">
                <label for="indirizzo">{% trans "Indirizzo *" %}</label>
                <input type="text" id="indirizzo" name="indirizzo" class="checkout-field" required>
              </div>

              <div class="campo campo-city custom-select" data-json="/static/data/province.json">
                <label for="citta">{% trans "Città *" %}</label>
                <input list="province" type="text" id="citta" name="citta" class="checkout-field select-input" required>
                <div class="select-dropdown"></div>
              </div>

              <div class="campo campo-region custom-select" data-json="/static/data/regioni.json">
                <label for="regione">{% trans "Regione *" %}</label>
                <input list="regioni" type="text" id="regione" name="regione" class="checkout-field select-input" required>
                <div class="select-dropdown"></div>
              </div>

              <div class="campo campo-zipcode">
                <label for="cap">{% trans "CAP *" %}</label>
                <input type="text" id="cap" name="cap" class="checkout-field" required>
              </div>

              <div class="c-continue">
                <button type="button">{% trans "Continua" %}</button>
              </div>

            </div>

            <div class="section-summary"></div>
          </div>


          <!-- STEP 2 -->
          <div class="c-checkout__spedition step-section">
            <hr />
            <div class="section-content">

              <h2 class="c-checkout__spedition-title">{% trans "Metodo di consegna *" %}</h2>

              <div class="campo campo-spedition">
                <label for="shipping-standard">
                  <input type="radio" id="shipping-standard" name="shipping_method" value="standard" required>
                  <p>{% trans "Spedizione" %}</p>
                  <p class="s-price">10,00 €</p>
                </label>
              </div>

              <div class="c-continue">
                <button id="shipping-continue" type="button">{% trans "Continua" %}</button>
              </div>

            </div>

            <div class="section-summary"></div>
          </div>


          <!-- STEP 3 -->
          <div class="c-checkout__payment step-section">
            <hr />
            <div class="section-content">
              <h2 class="c-checkout__payment-title">{% trans "Metodo di pagamento" %}</h2>

              <div class="campo campo-titolar">
                <label for="card-owner">{% trans "Titolare Carta *" %}</label>
                <input type="text" id="card-owner" required>
              </div>

              <div class="campo campo-card">
                <label>{% trans "Numero Carta *" %}</label>
                <div id="card-number-element" class="stripe-element"></div>
              </div>

              <div class="campo campo-pass">
                <label>{% trans "Scadenza *" %}</label>
                <div id="card-exp-element" class="stripe-element"></div>

                <label>{% trans "CVC *" %}</label>
                <div id="card-cvc-element" class="stripe-element"></div>
              </div>

              <!-- Campi nascosti Stripe -->
              <input type="hidden" id="payment_method" name="payment_method">
              <input type="hidden" id="payment_intent_id" name="payment_intent_id">

              <div class="c-continue">
                <button type="submit">{% trans "Ordina e paga" %}</button>
              </div>

            </div>

            <div class="section-summary"></div>
          </div>
        </form>
      </div>

      <!-- =========== Summary Order =========== -->
      <div class="c-checkout__summary">
        <h2 class="c-checkout__summary-title">{% trans "Riepilogo dell'ordine" %}</h2>
        <hr />

        <!-- dipinti comprati -->
        {% for item in items %}
          <div class="c-checkout__items">

            <div class="c-checkout__item-img">
              <img src="{{ item.image }}" alt="" />
            </div>

            <div class="c-checkout__item-desc">
              {{ item.details|safe }}
            </div>

            <div class="c-checkout__item-price">
              {{ item.price }} €
            </div>

          </div>
          <hr />
        {% endfor %}

        <!-- prezzi -->
        <div class="c-checkout__recap">

          <div class="c-checkout__item-subtotal">
            <p>{% trans "Subtotale" %}</p>
            <span id="summary-subtotal">{{ subtotal }} €</span>
          </div>

          <div class="c-checkout__item-spedition">
            <p>{% trans "Consegna" %}</p>
            <span id="summary-shipping">
              {% if shipping %}
                {{ shipping }} €
              {% else %}
                —
              {% endif %}
            </span>
          </div>

          <hr />

          <div class="c-checkout__item-total">
            <p>{% trans "Totale" %}</p>
            <span id="summary-total">
              {% if shipping %}
                {{ total }} €
              {% else %}
                {{ subtotal }} €
              {% endif %}
            </span>
          </div>

        </div>
      </div>
    </div>
  </main>

  <div class="c-footer">
    <p class="c-footer__copyright">
      Copyright &copy; 2025 Margherita Poli.
      {% trans "Tutti i diritti riservati" %}
    </p>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script src="{% static 'js/checkout.js' %}"></script>

</body>
</html>
